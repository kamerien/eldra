# Legacy/Vintage 対応計画

## 1. 課題分析

### 1.1 データ容量

```yaml
カード数:
    Standard: 約1,500枚
    Legacy/Vintage: 約20,000枚
    増加量: 約18,500枚

予想容量:
    テクスチャ: 約2.4GB
    カードデータ: 約20MB
    システム: 約80MB
    合計: 約2.5GB
```

### 1.2 技術的制約

```yaml
VRChat制限:
    ワールド容量: 200MB推奨
    メモリ使用量: 2GB以下
    テクスチャサイズ: 4096x4096最大
    Draw Calls: 100以下推奨
```

## 2. 対応策

### 2.1 分割ワールドシステム

```yaml
構成:
    メインワールド:
        - デッキ構築機能
        - カードデータベース
        - プレイヤー管理
        容量: 約150MB

    フォーマット別ワールド:
        Legacy World:
            - Legacyカード
            - 専用ルール
            容量: 約1.2GB

        Vintage World:
            - Vintageカード
            - 専用ルール
            容量: 約1.3GB

    共有システム:
        - デッキデータの保存/読み込み
        - プレイヤープロファイル
        - 戦績管理
```

### 2.2 動的ローディングシステム

```yaml
実装方式: 1. オンデマンドローディング
    - 必要なカードのみ読み込み
    - デッキリストベースの事前ロード
    - 未使用カードの解放

    2. キャッシュシステム
    - よく使用されるカードの優先保持
    - メモリ使用量の監視
    - 自動クリーンアップ

    3. テクスチャアトラス最適化
    - デッキごとのサブアトラス
    - 使用頻度ベースの配置
    - 圧縮率の動的調整
```

### 2.3 最適化戦略

```yaml
テクスチャ圧縮:
    標準カード:
        - 解像度: 280x390px
        - 形式: ASTC 6x6
        - サイズ: 約50KB/枚

    レアカード:
        - 解像度: 336x468px
        - 形式: ASTC 4x4
        - サイズ: 約100KB/枚

メモリ管理:
    アクティブメモリ:
        - デッキ内カード: 常時ロード
        - 場のカード: 高品質
        - 手札: 中品質

    非アクティブメモリ:
        - その他カード: 必要時ロード
        - 検索結果: 低品質
        - 履歴カード: 圧縮保持
```

## 3. 実装手順

### 3.1 基盤システム

```yaml
Phase 1: データベース設計
    - カード情報の階層化
    - 使用頻度の追跡
    - キャッシュシステム実装

Phase 2: ローディングシステム
    - 動的ロード機能
    - メモリ管理
    - パフォーマンス監視

Phase 3: UI/UX最適化
    - 非同期ローディングUI
    - プログレス表示
    - エラーハンドリング
```

### 3.2 ワールド連携

```yaml
データ共有:
    - デッキデータのシリアライズ
    - プレイヤー設定の保存
    - 統計情報の同期

ワールド間移動:
    - シームレスな遷移
    - データの引き継ぎ
    - 状態の保持
```

## 4. パフォーマンス目標

### 4.1 ロード時間

```yaml
初回ロード:
    メインワールド: 15秒以内
    フォーマットワールド: 30秒以内
    デッキデータ: 5秒以内

動的ロード:
    カード表示: 1秒以内
    検索結果: 2秒以内
    デッキ切替: 3秒以内
```

### 4.2 メモリ使用量

```yaml
実行時メモリ:
    システム基盤: 256MB
    アクティブデッキ: 128MB
    UI/エフェクト: 128MB
    バッファ: 512MB
    合計: 1024MB以下

キャッシュ:
    テクスチャ: 512MB
    カードデータ: 32MB
    検索インデックス: 32MB
    合計: 576MB以下
```

## 5. 運用計画

### 5.1 更新管理

```yaml
定期更新:
    - カードデータのパッチ
    - 使用統計の分析
    - キャッシュの最適化
    - パフォーマンス調整

緊急対応:
    - クリティカルバグ
    - パフォーマンス問題
    - 同期エラー
```

### 5.2 モニタリング

```yaml
監視項目:
    - メモリ使用量
    - ロード時間
    - フレームレート
    - ネットワーク遅延
    - エラー発生率

アラート条件:
    - メモリ使用量 > 1.8GB
    - ロード時間 > 45秒
    - FPS < 30
    - 同期遅延 > 1000ms
```

## 6. 展開計画

### 6.1 フェーズドリリース

```yaml
Phase 1: Limited Legacy
    - 人気デッキのカードのみ
    - 基本システムのテスト
    - フィードバック収集

Phase 2: Full Legacy
    - 全Legacyカード対応
    - パフォーマンス最適化
    - 機能拡張

Phase 3: Vintage導入
    - Vintageカード追加
    - 専用ルール実装
    - システム安定化
```

### 6.2 継続的改善

```yaml
最適化:
    - 使用統計に基づく調整
    - キャッシュ戦略の改善
    - 新圧縮技術の導入

機能拡張:
    - トーナメントサポート
    - リプレイシステム
    - 観戦モード
```
